-- WGU Medical Data Cleaning. Turning Yes/No strings into boolean True/False statements

-- highblood pressure to boolean, fix column name

ALTER TABLE public.patient 
RENAME COLUMN hignblood 
TO highbp;

ALTER TABLE public.patient 
ALTER highbp 
TYPE boolean 
USING CASE WHEN hignblood ='Yes' THEN TRUE 
ELSE FALSE
END;

ALTER TABLE public.patient 
ALTER COLUMN highbp 
SET DEFAULT FALSE;


-- stroke to boolean

ALTER TABLE public.patient 
ALTER stroke 
TYPE boolean 
USING CASE WHEN stroke ='Yes'
THEN TRUE
ELSE FALSE 
END;

ALTER TABLE public.patient 
ALTER COLUMN stroke 
SET DEFAULT FALSE;

-- arthritis to boolean

ALTER TABLE public.servicesaddon 
ALTER arthritis 
TYPE boolean 
USING CASE WHEN arthritis ='No' 
THEN FALSE 
ELSE TRUE 
END;

ALTER TABLE public.servicesaddon 
ALTER COLUMN arthritis 
SET DEFAULT FALSE;

-- diabetes to boolean

ALTER TABLE public.servicesaddon 
ALTER diabetes 
TYPE boolean 
USING CASE WHEN diabetes ='No' 
THEN FALSE 
ELSE TRUE 
END;

ALTER TABLE public.servicesaddon 
ALTER COLUMN diabetes 
SET DEFAULT FALSE;

-- hyperlipidemia to boolean

ALTER TABLE public.servicesaddon 
ALTER hyperlipidemia 
TYPE boolean 
USING CASE WHEN hyperlipidemia ='No' 
THEN FALSE 
ELSE TRUE 
END;

ALTER TABLE public.servicesaddon 
ALTER COLUMN hyperlipidemia 
SET DEFAULT FALSE;

-- asthma to boolean

ALTER TABLE public.servicesaddon 
ALTER asthma 
TYPE boolean 
USING CASE WHEN asthma ='No' 
THEN FALSE 
ELSE TRUE 
END;

ALTER TABLE public.servicesaddon 
ALTER COLUMN asthma 
SET DEFAULT FALSE;

-- overweight to boolean

ALTER TABLE public.servicesaddon 
ALTER overweight 
TYPE boolean 
USING CASE WHEN overweight ='No' 
THEN FALSE 
ELSE TRUE 
END;

ALTER TABLE public.servicesaddon 
ALTER COLUMN overweight 
SET DEFAULT FALSE;

--Since I'll be using one database in tableau I need to label the source of this data as being from WGU so I am adding a source column

ALTER TABLE public.patient 
ADD COLUMN source text;

UPDATE public.patient 
SET source = 'WGU';

--All prior usage of this dataset indicates that Gender 'Prefer not to answer' should be construed as non-binary. Updating this accordingly.

UPDATE public.patient 
SET gender = REPLACE(gender, 'Prefer not to answer', 'Non-Binary');


--CDC Data caps age at 80. So I will change any age above 80 in the WGU set to 80 as well.

UPDATE public.patient 
SET age = 80
WHERE age > 80;

-- Importing the 2 CSVs from the CDC data that I'm actually using. This is a lengthy process. 
-- In the real world I think I would do this in Python as I find it's quicker to pick and choose exactly what columns you want.

CREATE TABLE public.cdc_demo
(
	seqn text, 
	SDDSRVYR text, 
	RIDSTATR text, 
	gender text, 
	age numeric, 
	RIDAGEMN text, 
	RIDRETH1 text, 
	RIDRETH3 text, 
	RIDEXMON text, 
	RIDEXAGM text, 
	DMQMILIZ text,
	DMQADFC text, 
	DMDBORN4 text, 
	DMDCITZN text, 
	DMDYRSUS text, 
	DMDEDUC3 text,
	DMDEDUC2 text, 
	DMDMARTL text, 
	RIDEXPRG text, 
	SIALANG text, 
	SIAPROXY text,
	SIAINTRP text, 
	FIALANG text, 
	FIAPROXY text, 
	FIAINTRP text, 
	MIALANG text,
	MIAPROXY text, 
	MIAINTRP text, 
	AIALANGA text, 
	DMDHHSIZ text, 
	DMDFMSIZ text,
	small_children numeric, 
	older_children numeric, 
	DMDHHSZE text, 
	DMDHRGND text,
	DMDHRAGE text, 
	DMDHRBR4 text, 
	DMDHREDU text, 
	DMDHRMAR text, 
	DMDHSEDU text, 
	WTINT2YR text, 
	WTMEC2YR text, 
	SDMVPSU text, 
	SDMVSTRA text, 
	INDHHIN2 text,
	INDFMIN2 text, 
	INDFMPIR text,
 CONSTRAINT participant_id PRIMARY KEY (seqn)
);

ALTER TABLE public.cdc_demo
 OWNER TO postgres;

-- Import the demographic CSV into the demographic table. This is a large table and took a long time. 

COPY cdc_demo
FROM 'C:\Users\Public\Downloads\demographic.csv'
DELIMITER ','
CSV HEADER;


CREATE TABLE public.cdc_quest
(
	seqn text, 
	ACD011A text, 
	ACD011B text, 
	ACD011C text, 
	ACD040 text,
 	ACD110 text, ALQ101 text, ALQ110 text, ALQ120Q text, ALQ120U text,
 	ALQ130 text, ALQ141Q text, ALQ141U text, ALQ151 text, ALQ160 text,
	highbp text, BPQ030 text, BPD035 text, BPQ040A text, BPQ050A text,
 	BPQ056 text, BPD058 text, BPQ059 text, hyperlipidemia text, BPQ060 text,
 	BPQ070 text, BPQ090D text, BPQ100D text, CBD070 text, CBD090 text,
 	CBD110 text, CBD120 text, CBD130 text, HSD010 text, HSQ500 text,
 	HSQ510 text, HSQ520 text, HSQ571 text, HSQ580 text, HSQ590 text,
 	HSAQUEX text, CSQ010 text, CSQ020 text, CSQ030 text, CSQ040 text,
 	CSQ060 text, CSQ070 text, CSQ080 text, CSQ090A text, CSQ090B text,
 	CSQ090C text, CSQ090D text, CSQ100 text, CSQ110 text, CSQ120A text,
 	CSQ120B text, CSQ120C text, CSQ120D text, CSQ120E text, CSQ120F text,
 	CSQ120G text, CSQ120H text, CSQ140 text, CSQ160 text, CSQ170 text,
 	CSQ180 text, CSQ190 text, CSQ200 text, CSQ202 text, CSQ204 text,
 	CSQ210 text, CSQ220 text, CSQ240 text, CSQ250 text, CSQ260 text,
 	AUQ136 text, AUQ138 text, CDQ001 text, CDQ002 text, CDQ003 text, 
	CDQ004 text, CDQ005 text, CDQ006 text, CDQ009A text, CDQ009B text,
 	CDQ009C text, CDQ009D text, CDQ009E text, CDQ009F text, CDQ009G text,
 	CDQ009H text, CDQ008 text, CDQ010 text, diabetes text, DID040 text,
 	DIQ160 text, DIQ170 text, DIQ172 text, DIQ175A text, DIQ175B text,
 	DIQ175C text, DIQ175D text, DIQ175E text, DIQ175F text, DIQ175G text,
 	DIQ175H text, DIQ175I text, DIQ175J text, DIQ175K text, DIQ175L text,
 	DIQ175M text, DIQ175N text, DIQ175O text, DIQ175P text, DIQ175Q text,
 	DIQ175R text, DIQ175S text, DIQ175T text, DIQ175U text, DIQ175V text,
 	DIQ175W text, DIQ175X text, DIQ180 text, DIQ050 text, DID060 text,
 	DIQ060U text, DIQ070 text, DIQ230 text, DIQ240 text, DID250 text,
 	DID260 text, DIQ260U text, DIQ275 text, DIQ280 text, DIQ291 text,
 	DIQ300S text, DIQ300D text, DID310S text, DID310D text, DID320 text,
 	DID330 text, DID341 text, DID350 text, DIQ350U text, DIQ360 text,
 	DIQ080 text, DBQ010 text, DBD030 text, DBD041 text, DBD050 text,
 	DBD055 text, DBD061 text, DBQ073A text, DBQ073B text, DBQ073C text,
 	DBQ073D text, DBQ073E text, DBQ073U text, DBQ700 text,
 	DBQ197 text, DBQ223A text, DBQ223B text, DBQ223C text, DBQ223D text,
 	DBQ223E text, DBQ223U text, DBQ229 text, DBQ235A text,
 	DBQ235B text, DBQ235C text, DBQ301 text, DBQ330 text, DBQ360 text,
 	DBQ370 text, DBD381 text, DBQ390 text, DBQ400 text, DBD411 text,
 	DBQ421 text, DBQ424 text, DBD895 text, DBD900 text, DBD905 text,
 	DBD910 text, CBQ596 text, CBQ606 text, CBQ611 text, CBQ505 text,
 	CBQ535 text, CBQ540 text, CBQ545 text, CBQ550 text, CBQ552 text,
 	CBQ580 text, CBQ585 text, CBQ590 text, DED031 text, DEQ034A text,
 	DEQ034C text, DEQ034D text, DEQ038G text, DEQ038Q text, DED120 text,
 	DED125 text, DLQ010 text, DLQ020 text, DLQ040 text, DLQ050 text,
 	DLQ060 text, DLQ080 text, DPQ010 text, DPQ020 text, DPQ030 text,
 	DPQ040 text, DPQ050 text, DPQ060 text, DPQ070 text, DPQ080 text,
 	DPQ090 text, DPQ100 text, DUQ200 text, DUQ210 text, DUQ211 text,
 	DUQ213 text, DUQ215Q text, DUQ215U text, DUQ217 text,
 	DUQ219 text, DUQ220Q text, DUQ220U text, DUQ230 text,
 	DUQ240 text, DUQ250 text, DUQ260 text, DUQ270Q text, DUQ270U text,
 	DUQ272 text, DUQ280 text, DUQ290 text, DUQ300 text, DUQ310Q text,
 	DUQ310U text, DUQ320 text, DUQ330 text, DUQ340 text, DUQ350Q text,
 	DUQ350U text, DUQ352 text, DUQ360 text, DUQ370 text, DUQ380A text,
 	DUQ380B text, DUQ380C text, DUQ380D text, DUQ380E text,
 	DUQ390 text, DUQ400Q text, DUQ400U text, DUQ410 text,
 	DUQ420 text, DUQ430 text, ECD010 text, ECQ020 text, ECD070A text,
 	ECD070B text, ECQ080 text, ECQ090 text, WHQ030E text, MCQ080E text,
 	ECQ150 text, FSD032A text, FSD032B text, FSD032C text, FSD041 text,
 	FSD052 text, FSD061 text, FSD071 text, FSD081 text, FSD092 text,
 	FSD102 text, FSD032D text, FSD032E text, FSD032F text, FSD111 text,
 	FSD122 text, FSD132 text, FSD141 text, FSD146 text, FSDHH text,
 	FSDAD text, FSDCH text, FSD151 text, FSQ165 text, FSQ012 text,
 	FSD012N text, FSD230 text, FSD225 text, FSQ235 text, FSQ162 text,
 	FSD650ZC text, FSD660ZC text, FSD675 text, FSD680 text,
 	FSD670ZC text, FSQ690 text, FSQ695 text, FSD650ZW text,
 	FSD660ZW text, FSD670ZW text, HEQ010 text, HEQ020 text,
 	HEQ030 text, HEQ040 text, HIQ011 text, HIQ031A text, HIQ031B text,
 	HIQ031C text, HIQ031D text, HIQ031E text, HIQ031F text, HIQ031G text,
 	HIQ031H text, HIQ031I text, HIQ031J text, HIQ031AA text, HIQ260 text, 
	HIQ105 text, HIQ270 text, HIQ210 text, HOD050 text, HOQ065 text,
 	HUQ010 text, HUQ020 text, HUQ030 text, HUQ041 text, HUQ051 text,
 	HUQ061 text, HUQ071 text, HUD080 text, HUQ090 text, IMQ011 text,
 	IMQ020 text, IMQ040 text, IMQ070 text, IMQ080 text, IMQ090 text,
 	IMQ045 text, INQ020 text, INQ012 text, INQ030 text, INQ060 text,
 	INQ080 text, INQ090 text, INQ132 text, INQ140 text, INQ150 text,
 	IND235 text, INDFMMPI text, INDFMMPC text, INQ244 text,
 	IND247 text, MCQ010 text, MCQ025 text, asthma text, MCQ040 text,
 	MCQ050 text, AGQ030 text, MCQ053 text, MCQ070 text, MCQ075 text,
 	overweight text, MCQ082 text, MCQ084 text, MCQ086 text, MCQ092 text,
 	MCD093 text, MCQ149 text, MCQ151 text, arthritis text, MCQ180A text,
 	MCQ195 text, MCQ160N text, MCQ180N text, MCQ160B text,
 	MCQ180B text, MCQ160C text, MCQ180C text, MCQ160D text,
 	MCQ180D text, MCQ160E text, MCQ180E text, stroke text,
 	MCQ180F text, MCQ160G text, MCQ180G text, MCQ160M text, MCQ170M text, MCQ180M text, MCQ160K text, MCQ170K text,
 	MCQ180K text, MCQ160L text, MCQ170L text, MCQ180L text,
 	MCQ160O text, MCQ203 text, MCQ206 text, MCQ220 text, MCQ230A text,
 	MCQ230B text, MCQ230C text, MCQ230D text, MCQ240A text,
 	MCQ240AA text, MCQ240B text, MCQ240BB text, MCQ240C text,
 	MCQ240CC text, MCQ240D text, MCQ240DD text, MCQ240DK text, MCQ240E text, MCQ240F text, MCQ240G text, MCQ240H text,
 	MCQ240I text, MCQ240J text, MCQ240K text, MCQ240L text,
 	MCQ240M text, MCQ240N text, MCQ240O text, MCQ240P text,
 	MCQ240Q text, MCQ240R text, MCQ240S text, MCQ240T text,
	MCQ240U text, MCQ240V text, MCQ240W text, MCQ240X text,
 	MCQ240Y text, MCQ240Z text, MCQ300A text, MCQ300B text,
 	MCQ300C text, MCQ365A text, MCQ365B text, MCQ365C text,
 	MCQ365D text, MCQ370A text, MCQ370B text, MCQ370C text,
 	MCQ370D text, MCQ380 text, OCD150 text, OCQ180 text, OCQ210 text,
 	OCQ260 text, OCD270 text, OCQ380 text, OCD390G text, OCD395 text,
 	OHQ030 text, OHQ033 text, OHQ770 text, OHQ780A text, OHQ780B text,
 	OHQ780C text, OHQ780D text, OHQ780E text, OHQ780F text,
 	OHQ780G text, OHQ780H text, OHQ780I text, OHQ780J text,
 	OHQ780K text, OHQ555G text, OHQ555Q text, OHQ555U text,
	OHQ560G text, OHQ560Q text, OHQ560U text, OHQ565 text,
 	OHQ570Q text, OHQ570U text, OHQ575G text, OHQ575Q text,
 	OHQ575U text, OHQ580 text, OHQ585Q text, OHQ585U text,
 	OHQ590G text, OHQ590Q text, OHQ590U text, OHQ610 text,
 	OHQ612 text, OHQ614 text, OHQ620 text, OHQ640 text, OHQ680 text,
 	OHQ835 text, OHQ845 text, OHQ848G text, OHQ848Q text,
 	OHQ849 text, OHQ850 text, OHQ855 text, OHQ860 text, OHQ865 text,
 	OHQ870 text, OHQ875 text, OHQ880 text, OHQ885 text, OHQ895 text,
 	OHQ900 text, OSQ010A text, OSQ010B text, OSQ010C text, OSQ020A text,
 	OSQ020B text, OSQ020C text, OSD030AA text, OSQ040AA text,
 	OSD050AA text, OSD030AB text, OSQ040AB text, OSD050AB text, 
	OSD030AC text, OSQ040AC text, OSD050AC text, OSD030BA text, 
	OSQ040BA text, OSD050BA text, OSD030BB text, OSQ040BB text, 
	OSD050BB text, OSD030BC text, OSQ040BC text, OSD050BC text, 
	OSD030BD text, OSQ040BD text, OSD050BD text, OSD030BE text, 
	OSQ040BE text, OSD030BF text, OSQ040BF text, OSD030BG text, 
	OSQ040BG text, OSD030BH text, OSQ040BH text, OSD030BI text,
 	OSQ040BI text, OSD030BJ text, OSQ040BJ text, OSD030CA text, 
	OSQ040CA text, OSD050CA text, OSD030CB text, OSQ040CB text, 
	OSD050CB text, OSD030CC text, OSQ040CC text, OSQ080 text,
 	OSQ090A text, OSQ100A text, OSD110A text, OSQ120A text, OSQ090B text,
	OSQ100B text, OSD110B text, OSQ120B text, OSQ090C text, OSQ100C text,
 	OSD110C text, OSQ120C text, OSQ090D text, OSQ100D text, OSD110D text,
 	OSQ120D text, OSQ090E text, OSQ100E text, OSD110E text, OSQ120E text,
 	OSQ090F text, OSQ120F text, OSQ090G text, OSQ100G text, OSD110G text,
 	OSQ120G text, OSQ090H text, OSQ120H text, OSQ060 text, OSQ072 text,
 	OSQ130 text, OSQ140Q text, OSQ140U text, OSQ150 text, OSQ160A text,
 	OSQ160B text, OSQ170 text, OSQ180 text, OSQ190 text, OSQ200 text,
 	OSQ210 text, OSQ220 text, PFQ020 text, PFQ030 text, PFQ033 text,
 	PFQ041 text, PFQ049 text, PFQ051 text, PFQ054 text, PFQ057 text,
 	PFQ059 text, PFQ061A text, PFQ061B text, PFQ061C text, PFQ061D text,
 	PFQ061E text, PFQ061F text, PFQ061G text, PFQ061H text, PFQ061I text,
 	PFQ061J text, PFQ061K text, PFQ061L text, PFQ061M text, PFQ061N text,
 	PFQ061O text, PFQ061P text, PFQ061Q text, PFQ061R text, PFQ061S text,
 	PFQ061T text, PFQ063A text, PFQ063B text, PFQ063C text, PFQ063D text,
 	PFQ063E text, PFQ090 text, PAQ605 text, PAQ610 text, PAD615 text,
 	PAQ620 text, PAQ625 text, PAD630 text, PAQ635 text, PAQ640 text,
 	PAD645 text, PAQ650 text, PAQ655 text, PAD660 text, PAQ665 text,
 	PAQ670 text, PAD675 text, PAD680 text, PAQ706 text, PAQ710 text,
 	PAQ715 text, PAQ722 text, PAQ724A text, PAQ724B text, PAQ724C text,
 	PAQ724D text, PAQ724E text, PAQ724F text, PAQ724G text, PAQ724H text,
 	PAQ724I text, PAQ724J text, PAQ724K text, PAQ724L text, PAQ724M text,
 	PAQ724N text, PAQ724O text, PAQ724P text, PAQ724Q text, PAQ724R text,
 	PAQ724S text, PAQ724T text, PAQ724U text, PAQ724V text, PAQ724W text,
 	PAQ724X text, PAQ724Y text, PAQ724Z text, PAQ724AA text, PAQ724AB text, 
	PAQ724AC text, PAQ724AD text, PAQ724AE text, PAQ724AF text, 
	PAQ724CM text, PAQ731 text, PAD733 text, PAQ677 text, PAQ678 text,
 	PAQ740 text, PAQ742 text, PAQ744 text, PAQ746 text, PAQ748 text,
 	PAQ755 text, PAQ759A text, PAQ759B text, PAQ759C text, PAQ759D text,
 	PAQ759E text, PAQ759F text, PAQ759G text, PAQ759H text, PAQ759I text,
 	PAQ759J text, PAQ759K text, PAQ759L text, PAQ759M text, PAQ759N text,
 	PAQ759O text, PAQ759P text, PAQ759Q text, PAQ759R text, PAQ759S text,
 	PAQ759T text, PAQ759U text, PAQ759V text, PAQ762 text, PAQ764 text,
 	PAQ766 text, PAQ679 text, PAQ750 text, PAQ770 text, PAQ772A text,
 	PAQ772B text, PAQ772C text, PAAQUEX text, PUQ100 text, PUQ110 text,
 	RHQ010 text, RHQ020 text, RHQ031 text, RHD043 text, RHQ060 text,
 	RHQ070 text, RHQ074 text, RHQ076 text, RHQ078 text, RHQ131 text,
 	RHD143 text, RHQ160 text, RHQ162 text, RHQ163 text, RHQ166 text,
 	RHQ169 text, RHQ172 text, RHD173 text, RHQ171 text, RHD180 text,
 	RHD190 text, RHQ197 text, RHQ200 text, RHD280 text, RHQ291 text,
 	RHQ305 text, RHQ332 text, RHQ420 text, RHQ540 text, RHQ542A text,
 	RHQ542B text, RHQ542C text, RHQ542D text, RHQ554 text, RHQ560Q text,
 	RHQ560U text, RHQ570 text, RHQ576Q text, RHQ576U text,
 	RHQ580 text, RHQ586Q text, RHQ586U text, RHQ596 text,
 	RHQ602Q text, RHQ602U text, RXQ510 text, RXQ515 text,
 	RXQ520 text, RXQ525G text, RXQ525Q text, RXQ525U text,
 	RXD530 text, SLD010H text, SLQ050 text, SLQ060 text, SMQ020 text, 
	SMD030 text, SMQ040 text, SMQ050Q text, SMQ050U text,
 	SMD055 text, SMD057 text, SMQ078 text, SMD641 text, SMD650 text,
 	SMD093 text, SMDUPCA text, SMD100BR text, SMD100FL text,
 	SMD100MN text, SMD100LN text, SMD100TR text, SMD100NI text, 
	SMD100CO text, SMQ621 text, SMD630 text, SMQ661 text, SMQ665A text,
 	SMQ665B text, SMQ665C text, SMQ665D text, SMQ670 text,
 	SMQ848 text, SMQ852Q text, SMQ852U text, SMAQUEX2 text,
 	SMD460 text, SMD470 text, SMD480 text, SMQ856 text, SMQ858 text,
 	SMQ860 text, SMQ862 text, SMQ866 text, SMQ868 text, SMQ870 text,
 	SMQ872 text, SMQ874 text, SMQ876 text, SMQ878 text, SMQ880 text,
 	SMAQUEXx text, SMQ681 text, SMQ690A text, SMQ710 text,
 	SMQ720 text, SMQ725 text, SMQ690B text, SMQ740 text, SMQ690C text,
 	SMQ770 text, SMQ690G text, SMQ845 text, SMQ690H text,
 	SMQ849 text, SMQ851 text, SMQ690D text, SMQ800 text, SMQ690E text,
 	SMQ817 text, SMQ690I text, SMQ857 text, SMQ690J text, SMQ861 text,
 	SMQ863 text, SMQ690F text, SMQ830 text, SMQ840 text, SMDANY text,
 	SMAQUEXy text, SXD021 text, SXQ800 text, SXQ803 text, SXQ806 text,
 	SXQ809 text, SXQ700 text, SXQ703 text, SXQ706 text, SXQ709 text,
 	SXD031 text, SXD171 text, SXD510 text, SXQ824 text, SXQ827 text,
 	SXD633 text, SXQ636 text, SXQ639 text, SXD642 text, SXQ410 text,
 	SXQ550 text, SXQ836 text, SXQ841 text, SXQ853 text, SXD621 text,
 	SXQ624 text, SXQ627 text, SXD630 text, SXQ645 text, SXQ648 text,
 	SXQ610 text, SXQ251 text, SXQ590 text, SXQ600 text, SXD101 text,
 	SXD450 text, SXQ724 text, SXQ727 text, SXQ130 text, SXQ490 text,
 	SXQ741 text, SXQ753 text, SXQ260 text, SXQ265 text, SXQ267 text,
 	SXQ270 text, SXQ272 text, SXQ280 text, SXQ292 text, SXQ294 text,
 	WHD010 text, WHD020 text, WHQ030 text, WHQ040 text, WHD050 text,
 	WHQ060 text, WHQ070 text, WHD080A text, WHD080B text,
 	WHD080C text, WHD080D text, WHD080E text, WHD080F text,
 	WHD080G text, WHD080H text, WHD080I text, WHD080J text,
 	WHD080K text, WHD080M text, WHD080N text, WHD080O text, WHD080P text, WHD080Q text, WHD080R text, WHD080S text,
 	WHD080T text, WHD080U text, WHD080L text, WHD110 text,
 	WHD120 text, WHD130 text, WHD140 text, WHQ150 text, WHQ030M text,
 	WHQ500 text, WHQ520 text,
 	CONSTRAINT seqn_id PRIMARY KEY (seqn)
);

ALTER TABLE public.cdc_quest
 OWNER TO postgres;

-- Import the questionnaire CSV into the questionnaire table

COPY cdc_quest
FROM 'C:\Users\Public\Downloads\questionnaire.csv'
DELIMITER ','
CSV HEADER;

-- CDC Data Cleaning

-- Update gender column to match WGU data 

UPDATE public.cdc_demo 
SET gender = 
CASE WHEN gender = '1' THEN 'Male'
WHEN gender = '2' THEN 'Female' 
END;

-- Update arthritis column to match WGU data

ALTER TABLE public.cdc_quest 
ALTER arthritis 
TYPE boolean 
USING CASE WHEN arthritis = '1' THEN TRUE 
ELSE FALSE 
END;

-- Update ashtma column to match WGU data

ALTER TABLE public.cdc_quest 
ALTER asthma 
TYPE boolean 
USING CASE WHEN asthma = '1' THEN TRUE 
ELSE FALSE 
END;

-- Update diabetes column to match WGU data

ALTER TABLE public.cdc_quest 
ALTER diabetes 
TYPE boolean 
USING CASE
WHEN diabetes = '1' THEN TRUE 
ELSE FALSE 
END;

-- Update highbp column to match WGU data

ALTER TABLE public.cdc_quest 
ALTER highbp 
TYPE boolean 
USING CASE WHEN highbp = '1' THEN TRUE 
ELSE FALSE 
END;

-- Update hyperlipidemia column to match WGU data

ALTER TABLE public.cdc_quest 
ALTER hyperlipidemia 
TYPE boolean 
USING CASE WHEN hyperlipidemia = '1' THEN TRUE 
ELSE FALSE 
END;

-- Update overweight column to match WGU data

ALTER TABLE public.cdc_quest 
ALTER overweight 
TYPE boolean 
USING CASE WHEN overweight = '1' THEN TRUE 
ELSE FALSE 
END;

-- Update stroke column to match WGU data

ALTER TABLE public.cdc_quest 
ALTER stroke 
TYPE boolean 
USING CASE WHEN stroke = '1' THEN TRUE 
ELSE FALSE 
END;

-- Adding source column to differentiate from WGU data in tableau after table union

ALTER TABLE public.cdc_demo 
ADD COLUMN source text;

UPDATE public.cdc_demo 
SET source = 'CDC';

-- Removing minors from both data sets to standardize ages

DELETE FROM cdc_quest 
WHERE seqn IN (
	SELECT seqn AS id FROM
	cdc_demo WHERE age < 18);

DELETE FROM cdc_demo 
WHERE seqn IN (
	SELECT seqn AS id FROM
	cdc_demo WHERE age < 18);

-- Maintain referential integrity by adding foreign keys to WGU tables, as well as the CDC data

ALTER TABLE public.servicesaddon ADD FOREIGN KEY (patient_id) REFERENCES
public.patient(patient_id);

ALTER TABLE public.survey_responses_addon ADD FOREIGN KEY (patient_id)
REFERENCES public.patient(patient_id);

ALTER TABLE public.cdc_quest ADD FOREIGN KEY (seqn) REFERENCES
public.cdc_demo(seqn); 

-- Create UNION table for all data that I will use in Tableau. To do this I will create two temp tables, one from each source (WGU/CDC),
-- UNION both tables together into a third final_data table, and then delete the two temp tables. 

CREATE TABLE wgunew AS (
 SELECT pat.age, pat.gender, cond.asthma, cond.diabetes,
pat.highbp, cond.overweight, pat.source
 FROM patient AS pat
 INNER JOIN servicesaddon AS cond
 ON pat.patient_id = cond.patient_id);

CREATE TABLE cdcnew AS (
 SELECT demo.age, demo.gender, ques.asthma, ques.diabetes, 
ques.highbp, ques.overweight, demo.source
 FROM cdc_demo AS demo
 INNER JOIN cdc_quest AS ques
 ON demo.seqn = ques.seqn);

CREATE TABLE final_data AS (
 SELECT *
 FROM wgunew
 UNION ALL
 SELECT *
 FROM cdcnew);
DROP TABLE IF EXISTS wgunew;
DROP TABLE IF EXISTS cdcnew; 
